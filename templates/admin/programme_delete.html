{% extends 'admin_base.html' %}

{% block title %}Delete Programme - {{ programme.code }}{% endblock %}

{% block page_title %}Delete Programme{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

<style>
    .breadcrumb {
        padding: 0;
        margin-bottom: 20px;
        font-size: 14px;
        list-style: none;
        display: flex;
        flex-wrap: wrap;
    }

    .breadcrumb-item {
        color: #64748B;
    }

    .breadcrumb-item + .breadcrumb-item::before {
        content: "/ ";
        color: #94A3B8;
        padding: 0 8px;
    }

    .breadcrumb-item.active {
        color: #1E293B;
        font-weight: 500;
    }

    .breadcrumb a {
        color: #4F46E5;
        text-decoration: none;
    }

    .breadcrumb a:hover {
        color: #4338CA;
    }

    .delete-container {
        background: white;
        border-radius: 5px;
        padding: 30px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        border: 1px solid #f0f0f0;
        max-width: 700px;
        margin: 0 auto;
    }

    .warning-header {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 20px;
        background: #FEF2F2;
        border: 2px solid #FCA5A5;
        border-radius: 5px;
        margin-bottom: 25px;
    }

    .warning-icon {
        font-size: 48px;
        color: #DC2626;
    }

    .warning-content h3 {
        margin: 0 0 5px 0;
        color: #991B1B;
        font-size: 20px;
        font-weight: 700;
    }

    .warning-content p {
        margin: 0;
        color: #7F1D1D;
        font-size: 14px;
    }

    .programme-info {
        background: #F8FAFC;
        border-radius: 5px;
        padding: 20px;
        margin-bottom: 25px;
        border: 1px solid #E2E8F0;
    }

    .info-row {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid #E2E8F0;
    }

    .info-row:last-child {
        border-bottom: none;
    }

    .info-label {
        font-weight: 600;
        color: #64748B;
        font-size: 14px;
    }

    .info-value {
        color: #1E293B;
        font-size: 14px;
        font-weight: 500;
    }

    .impact-section {
        margin-bottom: 25px;
    }

    .impact-title {
        font-size: 16px;
        font-weight: 600;
        color: #1E293B;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .impact-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .impact-item {
        padding: 12px;
        background: #FFFBEB;
        border-left: 3px solid #F59E0B;
        margin-bottom: 10px;
        border-radius: 3px;
        font-size: 14px;
        color: #78350F;
    }

    .impact-item i {
        margin-right: 8px;
        color: #F59E0B;
    }

    .confirmation-text {
        background: #FEF2F2;
        border: 1px solid #FCA5A5;
        border-radius: 5px;
        padding: 15px;
        margin-bottom: 25px;
        font-size: 14px;
        color: #7F1D1D;
        line-height: 1.6;
    }

    .btn-group {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        padding-top: 20px;
        border-top: 1px solid #E5E7EB;
    }

    .btn {
        padding: 12px 24px;
        border-radius: 5px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: none;
    }

    .btn-secondary {
        background: #64748B;
        color: white;
    }

    .btn-secondary:hover {
        background: #475569;
    }

    .btn-danger {
        background: #DC2626;
        color: white;
    }

    .btn-danger:hover {
        background: #B91C1C;
    }

    @media (max-width: 768px) {
        .warning-header {
            flex-direction: column;
            text-align: center;
        }

        .info-row {
            flex-direction: column;
            gap: 5px;
        }

        .btn-group {
            flex-direction: column-reverse;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'admin_dashboard' %}"><i class="bi bi-house-door"></i> Dashboard</a></li>
        <li class="breadcrumb-item"><a href="{% url 'programme_list' %}">Programmes</a></li>
        <li class="breadcrumb-item"><a href="{% url 'programme_detail' programme.code %}">{{ programme.code }}</a></li>
        <li class="breadcrumb-item active" aria-current="page">Delete</li>
    </ol>
</nav>

<!-- Delete Container -->
<div class="delete-container">
    <!-- Warning Header -->
    <div class="warning-header">
        <div class="warning-icon">
            <i class="bi bi-exclamation-triangle-fill"></i>
        </div>
        <div class="warning-content">
            <h3>Confirm Programme Deactivation</h3>
            <p>This action will deactivate the programme and may affect students</p>
        </div>
    </div>

    <!-- Programme Information -->
    <div class="programme-info">
        <div class="info-row">
            <span class="info-label">Programme Code:</span>
            <span class="info-value">{{ programme.code }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">Programme Name:</span>
            <span class="info-value">{{ programme.name }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">Level:</span>
            <span class="info-value">{{ programme.get_level_display }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">Department:</span>
            <span class="info-value">{{ programme.department.name }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">Duration:</span>
            <span class="info-value">{{ programme.duration_years }} Years</span>
        </div>
    </div>

    <!-- Impact Analysis -->
    <div class="impact-section">
        <h4 class="impact-title">
            <i class="bi bi-info-circle"></i>
            What will happen:
        </h4>
        <ul class="impact-list">
            <li class="impact-item">
                <i class="bi bi-mortarboard-x"></i>
                The programme will be marked as <strong>inactive</strong> (not permanently deleted)
            </li>
            {% if active_students > 0 %}
            <li class="impact-item">
                <i class="bi bi-people"></i>
                <strong>{{ active_students }}</strong> active student(s) are currently enrolled in this programme
            </li>
            {% endif %}
            {% if total_units > 0 %}
            <li class="impact-item">
                <i class="bi bi-journal-text"></i>
                <strong>{{ total_units }}</strong> unit(s) are configured in this programme structure
            </li>
            {% endif %}
            <li class="impact-item">
                <i class="bi bi-lock"></i>
                New student admissions will not be allowed for this programme
            </li>
            <li class="impact-item">
                <i class="bi bi-clock-history"></i>
                All historical data and records will be preserved
            </li>
            <li class="impact-item">
                <i class="bi bi-arrow-counterclockwise"></i>
                This action can be reversed by reactivating the programme
            </li>
        </ul>
    </div>

    <!-- Confirmation Text -->
    <div class="confirmation-text">
        <strong>Note:</strong> This is a soft delete operation. The programme will be deactivated but not permanently removed from the system. Current students can continue their studies, but no new students can be admitted. You can reactivate this programme later if needed by editing it.
    </div>

    <!-- Form -->
    <form method="post" action="{% url 'programme_delete' programme.code %}">
        {% csrf_token %}
        
        <!-- Action Buttons -->
        <div class="btn-group">
            <a href="{% url 'programme_detail' programme.code %}" class="btn btn-secondary">
                <i class="bi bi-x-circle"></i> Cancel
            </a>
            <button type="submit" class="btn btn-danger">
                <i class="bi bi-check-circle"></i> Yes, Deactivate Programme
            </button>
        </div>
    </form>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Confirmation dialog
    document.querySelector('form').addEventListener('submit', function(e) {
        const confirmed = confirm('Are you sure you want to deactivate this programme? This will affect {{ active_students }} active student(s).');
        if (!confirmed) {
            e.preventDefault();
        }
    });
</script>
{% endblock %}