{% extends 'admin_base.html' %}
{% load admin_calender_filter %}
{% load static %}

{% block title %}Academic Calendar - Admin Dashboard{% endblock %}

{% block page_title %}Academic Calendar{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

<style>
    .breadcrumb {
        padding: 0;
        margin-bottom: 20px;
        font-size: 14px;
        list-style: none;
        display: flex;
        flex-wrap: wrap;
    }

    .breadcrumb-item {
        color: #64748B;
    }

    .breadcrumb-item + .breadcrumb-item::before {
        content: "/ ";
        color: #94A3B8;
        padding: 0 8px;
    }

    .breadcrumb-item.active {
        color: #1E293B;
        font-weight: 500;
    }

    .breadcrumb a {
        color: #4F46E5;
        text-decoration: none;
        transition: color 0.3s ease;
    }

    .breadcrumb a:hover {
        color: #4338CA;
    }

    /* Stats Cards */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        border: 1px solid #E2E8F0;
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    }

    .stat-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }

    .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
    }

    .stat-icon.events {
        background: #EEF2FF;
        color: #4F46E5;
    }

    .stat-icon.announcements {
        background: #FEF3C7;
        color: #F59E0B;
    }

    .stat-icon.semester {
        background: #D1FAE5;
        color: #10B981;
    }

    .stat-icon.students {
        background: #FCE7F3;
        color: #EC4899;
    }

    .stat-value {
        font-size: 32px;
        font-weight: 700;
        color: #1E293B;
        margin-bottom: 4px;
    }

    .stat-label {
        font-size: 14px;
        color: #64748B;
        font-weight: 500;
    }

    .stat-subtitle {
        font-size: 12px;
        color: #94A3B8;
        margin-top: 8px;
    }

    /* Calendar Section */
    .section-container {
        background: white;
        border-radius: 8px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        margin-bottom: 30px;
        border: 1px solid #E2E8F0;
    }

    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #E2E8F0;
    }

    .calendar-nav {
        display: flex;
        gap: 12px;
        align-items: center;
    }

    .nav-btn {
        padding: 10px 18px;
        background: #F8FAFC;
        border: 1px solid #E2E8F0;
        border-radius: 6px;
        color: #64748B;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .nav-btn:hover {
        background: #4F46E5;
        color: white;
        border-color: #4F46E5;
        transform: translateY(-1px);
    }

    .month-year {
        font-size: 26px;
        font-weight: 700;
        color: #1E293B;
    }

    .calendar-actions {
        display: flex;
        gap: 10px;
    }

    .today-btn, .add-event-btn {
        padding: 10px 18px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .today-btn {
        background: #4F46E5;
        color: white;
    }

    .today-btn:hover {
        background: #4338CA;
        transform: translateY(-1px);
    }

    .add-event-btn {
        background: #10B981;
        color: white;
    }

    .add-event-btn:hover {
        background: #059669;
        transform: translateY(-1px);
    }

    .calendar-legend {
        display: flex;
        gap: 24px;
        flex-wrap: wrap;
        margin-bottom: 24px;
        padding: 16px;
        background: #F8FAFC;
        border-radius: 6px;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: #64748B;
        font-weight: 500;
    }

    .legend-dot {
        width: 14px;
        height: 14px;
        border-radius: 50%;
    }

    .legend-dot.event {
        background: #4F46E5;
    }

    .legend-dot.announcement {
        background: #F59E0B;
    }

    .legend-dot.semester {
        background: #10B981;
    }

    .legend-dot.registration {
        background: #EC4899;
    }

    .legend-dot.class {
        background: #8B5CF6;
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: #E2E8F0;
        border: 1px solid #E2E8F0;
        border-radius: 8px;
        overflow: hidden;
    }

    .calendar-day-header {
        background: #F8FAFC;
        padding: 14px;
        text-align: center;
        font-size: 13px;
        font-weight: 700;
        color: #475569;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .calendar-day {
        background: white;
        min-height: 130px;
        padding: 10px;
        position: relative;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .calendar-day:hover {
        background: #FAFAFA;
        box-shadow: inset 0 0 0 2px #4F46E5;
    }

    .calendar-day.empty {
        background: #F8FAFC;
        cursor: default;
    }

    .calendar-day.empty:hover {
        box-shadow: none;
        background: #F8FAFC;
    }

    .calendar-day.today {
        background: #EEF2FF;
        box-shadow: inset 0 0 0 2px #4F46E5;
    }

    .day-number {
        font-size: 15px;
        font-weight: 700;
        color: #1E293B;
        margin-bottom: 8px;
    }

    .calendar-day.today .day-number {
        color: #4F46E5;
        background: white;
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
    }

    .day-indicators {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-top: 8px;
    }

    .indicator {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .indicator.event {
        background: #4F46E5;
    }

    .indicator.announcement {
        background: #F59E0B;
    }

    .indicator.semester {
        background: #10B981;
    }

    .indicator.registration {
        background: #EC4899;
    }

    .indicator.class {
        background: #8B5CF6;
    }

    .day-content {
        font-size: 11px;
        color: #64748B;
        margin-top: 8px;
        line-height: 1.5;
    }

    .day-item {
        padding: 3px 6px;
        margin-bottom: 4px;
        border-radius: 4px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-weight: 500;
    }

    .day-item.event {
        background: #EEF2FF;
        color: #4338CA;
    }

    .day-item.announcement {
        background: #FEF3C7;
        color: #92400E;
    }

    .day-item.semester {
        background: #D1FAE5;
        color: #065F46;
    }

    .day-item.registration {
        background: #FCE7F3;
        color: #9F1239;
    }

    .day-item.class {
        background: #EDE9FE;
        color: #6B21A8;
    }

    /* Modal Styles */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(2px);
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: white;
        border-radius: 8px;
        padding: 0;
        max-width: 700px;
        width: 90%;
        max-height: 85vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 24px;
        border-bottom: 2px solid #E2E8F0;
        background: #F8FAFC;
    }

    .modal-title {
        font-size: 22px;
        font-weight: 700;
        color: #1E293B;
    }

    .modal-close {
        background: white;
        border: 1px solid #E2E8F0;
        font-size: 20px;
        color: #64748B;
        cursor: pointer;
        padding: 0;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        transition: all 0.3s ease;
    }

    .modal-close:hover {
        background: #F1F5F9;
        color: #1E293B;
        border-color: #CBD5E1;
    }

    .modal-body {
        padding: 24px;
        overflow-y: auto;
        flex: 1;
    }

    .modal-section {
        margin-bottom: 28px;
    }

    .modal-section:last-child {
        margin-bottom: 0;
    }

    .modal-section-title {
        font-size: 17px;
        font-weight: 700;
        color: #1E293B;
        margin-bottom: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
        padding-bottom: 8px;
        border-bottom: 1px solid #E2E8F0;
    }

    .modal-item {
        background: #F8FAFC;
        padding: 14px;
        border-radius: 6px;
        margin-bottom: 12px;
        border-left: 4px solid;
        transition: all 0.2s ease;
    }

    .modal-item:hover {
        background: #F1F5F9;
        transform: translateX(2px);
    }

    .modal-item.event {
        border-left-color: #4F46E5;
    }

    .modal-item.announcement {
        border-left-color: #F59E0B;
    }

    .modal-item.semester {
        border-left-color: #10B981;
    }

    .modal-item.registration {
        border-left-color: #EC4899;
    }

    .modal-item.class {
        border-left-color: #8B5CF6;
    }

    .modal-item-title {
        font-weight: 700;
        color: #1E293B;
        margin-bottom: 6px;
        font-size: 14px;
    }

    .modal-item-description {
        font-size: 13px;
        color: #64748B;
        margin-bottom: 8px;
        line-height: 1.5;
    }

    .modal-item-meta {
        font-size: 12px;
        color: #64748B;
        display: flex;
        gap: 14px;
        flex-wrap: wrap;
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .badge {
        display: inline-flex;
        align-items: center;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.3px;
    }

    .badge.mandatory {
        background: #FEE2E2;
        color: #991B1B;
    }

    .badge.urgent {
        background: #FEE2E2;
        color: #991B1B;
    }

    .badge.high {
        background: #FED7AA;
        color: #9A3412;
    }

    .badge.current {
        background: #D1FAE5;
        color: #065F46;
    }

    .loading {
        text-align: center;
        padding: 50px;
        color: #94A3B8;
    }

    .loading-spinner {
        font-size: 36px;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* Upcoming Events Sidebar */
    .sidebar-section {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        border: 1px solid #E2E8F0;
    }

    .sidebar-title {
        font-size: 16px;
        font-weight: 700;
        color: #1E293B;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .upcoming-event {
        padding: 12px;
        border-left: 3px solid #4F46E5;
        background: #F8FAFC;
        border-radius: 4px;
        margin-bottom: 12px;
        transition: all 0.2s ease;
    }

    .upcoming-event:hover {
        background: #F1F5F9;
        transform: translateX(2px);
    }

    .upcoming-event-title {
        font-weight: 600;
        color: #1E293B;
        font-size: 13px;
        margin-bottom: 4px;
    }

    .upcoming-event-date {
        font-size: 12px;
        color: #64748B;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #94A3B8;
    }

    .empty-state i {
        font-size: 48px;
        margin-bottom: 12px;
        opacity: 0.5;
    }

    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }

        .calendar-header {
            flex-direction: column;
            gap: 16px;
        }

        .month-year {
            font-size: 22px;
        }

        .calendar-actions {
            width: 100%;
        }

        .today-btn, .add-event-btn {
            flex: 1;
        }

        .calendar-legend {
            flex-direction: column;
            gap: 12px;
        }

        .calendar-day {
            min-height: 90px;
            padding: 8px;
        }

        .day-number {
            font-size: 13px;
        }

        .day-content {
            display: none;
        }

        .modal-content {
            width: 95%;
            max-height: 90vh;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'admin_dashboard' %}"><i class="bi bi-house-door"></i> Dashboard</a></li>
        <li class="breadcrumb-item active" aria-current="page">Academic Calendar</li>
    </ol>
</nav>

<!-- Statistics Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-card-header">
            <div>
                <div class="stat-value">{{ stats.total_events }}</div>
                <div class="stat-label">Events This Month</div>
            </div>
            <div class="stat-icon events">
                <i class="bi bi-calendar-event"></i>
            </div>
        </div>
        <div class="stat-subtitle">Published and upcoming</div>
    </div>

    <div class="stat-card">
        <div class="stat-card-header">
            <div>
                <div class="stat-value">{{ stats.total_announcements }}</div>
                <div class="stat-label">Announcements</div>
            </div>
            <div class="stat-icon announcements">
                <i class="bi bi-megaphone"></i>
            </div>
        </div>
        <div class="stat-subtitle">Active this month</div>
    </div>

    <div class="stat-card">
        <div class="stat-card-header">
            <div>
                <div class="stat-value">{{ stats.registered_students }}</div>
                <div class="stat-label">Registered Students</div>
            </div>
            <div class="stat-icon students">
                <i class="bi bi-people"></i>
            </div>
        </div>
        <div class="stat-subtitle">Out of {{ stats.total_students }} total</div>
    </div>

    <div class="stat-card">
        <div class="stat-card-header">
            <div style="max-width: 180px;">
                <div class="stat-value" style="font-size: 18px; line-height: 1.2;">{{ stats.active_semester }}</div>
                <div class="stat-label">Current Semester</div>
            </div>
            <div class="stat-icon semester">
                <i class="bi bi-mortarboard"></i>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-9">
        <div class="section-container">
            <!-- Calendar Header -->
            <div class="calendar-header">
                <div class="calendar-nav">
                    <button class="nav-btn" onclick="navigateMonth(-1)">
                        <i class="bi bi-chevron-left"></i> Previous
                    </button>
                    <h2 class="month-year">{{ month_name }} {{ year }}</h2>
                    <button class="nav-btn" onclick="navigateMonth(1)">
                        Next <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
                <div class="calendar-actions">
                    <button class="today-btn" onclick="goToToday()">
                        <i class="bi bi-calendar-day"></i> Today
                    </button>
                    <button class="add-event-btn" onclick="window.location.href='{% url 'admin_dashboard' %}'">
                        <i class="bi bi-plus-circle"></i> Add Event
                    </button>
                </div>
            </div>

            <!-- Legend -->
            <div class="calendar-legend">
                <div class="legend-item">
                    <span class="legend-dot event"></span>
                    <span>Events</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot announcement"></span>
                    <span>Announcements</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot semester"></span>
                    <span>Semester Dates</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot registration"></span>
                    <span>Registration</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot class"></span>
                    <span>Classes</span>
                </div>
            </div>

            <!-- Calendar Grid -->
            <div class="calendar-grid">
                <!-- Day Headers -->
                <div class="calendar-day-header">Sun</div>
                <div class="calendar-day-header">Mon</div>
                <div class="calendar-day-header">Tue</div>
                <div class="calendar-day-header">Wed</div>
                <div class="calendar-day-header">Thu</div>
                <div class="calendar-day-header">Fri</div>
                <div class="calendar-day-header">Sat</div>

                <!-- Calendar Days -->
                {% for week in calendar %}
                    {% for day in week %}
                        {% if day == 0 %}
                            <div class="calendar-day empty"></div>
                        {% else %}
                            {% with date_key=year|stringformat:"d"|add:"-"|add:month|stringformat:"02d"|add:"-"|add:day|stringformat:"02d" %}
                            {% with day_info=calendar_data|get_item:date_key %}
                            <div class="calendar-day {% if year == today.year and month == today.month and day == today.day %}today{% endif %}" 
                                 data-date="{{ date_key }}"
                                 onclick="showDayDetails('{{ date_key }}')">
                                <div class="day-number">{{ day }}</div>
                                
                                {% if day_info %}
                                <div class="day-indicators">
                                    {% if day_info.events %}
                                        <span class="indicator event" title="{{ day_info.events|length }} event(s)"></span>
                                    {% endif %}
                                    {% if day_info.announcements %}
                                        <span class="indicator announcement" title="{{ day_info.announcements|length }} announcement(s)"></span>
                                    {% endif %}
                                    {% if day_info.semesters %}
                                        <span class="indicator semester" title="Semester date"></span>
                                    {% endif %}
                                    {% if day_info.registrations %}
                                        <span class="indicator registration" title="Registration deadline"></span>
                                    {% endif %}
                                    {% if day_info.classes %}
                                        <span class="indicator class" title="{{ day_info.classes|length }} class(es)"></span>
                                    {% endif %}
                                </div>
                                
                                <div class="day-content">
                                    {% for event in day_info.events|slice:":2" %}
                                        <div class="day-item event">
                                            <i class="{{ event.icon }}"></i> {{ event.title|truncatechars:18 }}
                                        </div>
                                    {% endfor %}
                                    
                                    {% for announcement in day_info.announcements|slice:":1" %}
                                        <div class="day-item announcement">
                                            <i class="bi bi-megaphone"></i> {{ announcement.title|truncatechars:18 }}
                                        </div>
                                    {% endfor %}
                                    
                                    {% for sem in day_info.semesters|slice:":1" %}
                                        <div class="day-item semester">
                                            <i class="bi bi-calendar-check"></i> {{ sem.title|truncatechars:18 }}
                                        </div>
                                    {% endfor %}
                                    
                                    {% for reg in day_info.registrations|slice:":1" %}
                                        <div class="day-item registration">
                                            <i class="bi bi-clipboard-check"></i> {{ reg.title|truncatechars:18 }}
                                        </div>
                                    {% endfor %}
                                    
                                    {% if day_info.classes %}
                                        <div class="day-item class">
                                            <i class="bi bi-book"></i> {{ day_info.classes|length }} class{% if day_info.classes|length > 1 %}es{% endif %}
                                        </div>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                            {% endwith %}
                            {% endwith %}
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="col-lg-3">
        <!-- Upcoming Events -->
        <div class="sidebar-section">
            <h3 class="sidebar-title">
                <i class="bi bi-calendar-check"></i>
                Upcoming Events
            </h3>
            {% if upcoming_events %}
                {% for event in upcoming_events %}
                <div class="upcoming-event">
                    <div class="upcoming-event-title">
                        <i class="bi bi-circle-fill" style="font-size: 6px; color: #4F46E5;"></i>
                        {{ event.title }}
                    </div>
                    <div class="upcoming-event-date">
                        <i class="bi bi-calendar3"></i>
                        {{ event.event_date|date:"M d, Y" }} at {{ event.start_time|time:"H:i" }}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <i class="bi bi-calendar-x"></i>
                    <p>No upcoming events</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Day Details Modal -->
<div class="modal" id="dayModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="modalTitle">Day Details</h3>
            <button class="modal-close" onclick="closeModal()">
                <i class="bi bi-x"></i>
            </button>
        </div>
        <div class="modal-body" id="modalBody">
            <div class="loading">
                <i class="bi bi-hourglass-split loading-spinner"></i>
                <p>Loading...</p>
            </div>
        </div>
    </div>
</div>

<script>
// Store calendar data
const calendarData = {{ calendar_data_json|safe }};
</script>
{% endblock %}

{% block extra_js %}
<script>
    // Navigation functions
    function navigateMonth(direction) {
        let newMonth = {{ month }} + direction;
        let newYear = {{ year }};
        
        if (newMonth > 12) {
            newMonth = 1;
            newYear++;
        } else if (newMonth < 1) {
            newMonth = 12;
            newYear--;
        }
        
        window.location.href = `?month=${newMonth}&year=${newYear}`;
    }
    
    function goToToday() {
        const today = new Date();
        window.location.href = `?month=${today.getMonth() + 1}&year=${today.getFullYear()}`;
    }
    
    // Show day details in modal
    function showDayDetails(dateKey) {
        const modal = document.getElementById('dayModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        
        // Format date for display
        const date = new Date(dateKey + 'T00:00:00');
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const formattedDate = date.toLocaleDateString('en-US', options);
        
        modalTitle.textContent = formattedDate;
        
        // Get data for this date
        const dayData = calendarData[dateKey];
        
        if (!dayData || (!dayData.events.length && !dayData.announcements.length && 
            !dayData.semesters.length && !dayData.registrations.length && !dayData.classes.length)) {
            modalBody.innerHTML = '<div class="empty-state"><i class="bi bi-calendar-x"></i><p>No activities scheduled for this day.</p></div>';
        } else {
            let html = '';
            
            // Events
            if (dayData.events && dayData.events.length > 0) {
                html += '<div class="modal-section"><div class="modal-section-title"><i class="bi bi-calendar-event"></i> Events (' + dayData.events.length + ')</div>';
                dayData.events.forEach(event => {
                    html += `
                        <div class="modal-item event">
                            <div class="modal-item-title">
                                <i class="${event.icon}"></i> ${event.title}
                                ${event.is_mandatory ? '<span class="badge mandatory">Mandatory</span>' : ''}
                            </div>
                            ${event.description ? `<div class="modal-item-description">${event.description}</div>` : ''}
                            <div class="modal-item-meta">
                                <span class="meta-item"><i class="bi bi-clock"></i> ${event.time}</span>
                                <span class="meta-item"><i class="bi bi-geo-alt"></i> ${event.venue}</span>
                                <span class="meta-item"><i class="bi bi-tag"></i> ${event.type}</span>
                                <span class="meta-item"><i class="bi bi-person"></i> ${event.organizer}</span>
                            </div>
                            ${event.attendees !== null ? `<div class="modal-item-meta" style="margin-top: 6px;"><span class="meta-item"><i class="bi bi-people"></i> ${event.attendees}/${event.max_attendees || 'âˆž'} registered</span></div>` : ''}
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Announcements
            if (dayData.announcements && dayData.announcements.length > 0) {
                html += '<div class="modal-section"><div class="modal-section-title"><i class="bi bi-megaphone"></i> Announcements (' + dayData.announcements.length + ')</div>';
                dayData.announcements.forEach(announcement => {
                    const priorityClass = announcement.priority.toLowerCase();
                    html += `
                        <div class="modal-item announcement">
                            <div class="modal-item-title">
                                <i class="bi bi-megaphone"></i> ${announcement.title}
                                ${['Urgent', 'High'].includes(announcement.priority) ? `<span class="badge ${priorityClass}">${announcement.priority}</span>` : ''}
                            </div>
                            <div class="modal-item-description">${announcement.content_preview}</div>
                            <div class="modal-item-meta">
                                <span class="meta-item"><i class="bi bi-person"></i> ${announcement.author}</span>
                                <span class="meta-item"><i class="bi bi-flag"></i> ${announcement.priority}</span>
                                <span class="meta-item"><i class="bi bi-mortarboard"></i> ${announcement.programmes}</span>
                                ${announcement.expiry_date ? `<span class="meta-item"><i class="bi bi-calendar-x"></i> Expires: ${announcement.expiry_date}</span>` : ''}
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Semester Information
            if (dayData.semesters && dayData.semesters.length > 0) {
                html += '<div class="modal-section"><div class="modal-section-title"><i class="bi bi-calendar-check"></i> Semester Information</div>';
                dayData.semesters.forEach(sem => {
                    html += `
                        <div class="modal-item semester">
                            <div class="modal-item-title">
                                <i class="bi bi-mortarboard"></i> ${sem.title}
                                ${sem.is_current ? '<span class="badge current">Current</span>' : ''}
                            </div>
                            <div class="modal-item-meta">
                                <span class="meta-item"><i class="bi bi-info-circle"></i> ${sem.semester}</span>
                                <span class="meta-item"><i class="bi bi-calendar2"></i> ${sem.academic_year}</span>
                                <span class="meta-item"><i class="bi bi-bookmark"></i> ${sem.type.charAt(0).toUpperCase() + sem.type.slice(1)} Date</span>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Registration Deadlines
            if (dayData.registrations && dayData.registrations.length > 0) {
                html += '<div class="modal-section"><div class="modal-section-title"><i class="bi bi-clipboard-check"></i> Registration Deadlines</div>';
                dayData.registrations.forEach(reg => {
                    const percentage = reg.total_students > 0 ? Math.round((reg.registered_count / reg.total_students) * 100) : 0;
                    html += `
                        <div class="modal-item registration">
                            <div class="modal-item-title">
                                <i class="bi bi-clipboard-check"></i> ${reg.title}
                                ${reg.is_current ? '<span class="badge current">Current</span>' : ''}
                            </div>
                            <div class="modal-item-meta">
                                <span class="meta-item"><i class="bi bi-info-circle"></i> ${reg.semester}</span>
                                <span class="meta-item"><i class="bi bi-calendar2"></i> ${reg.academic_year}</span>
                                <span class="meta-item"><i class="bi bi-people"></i> ${reg.registered_count}/${reg.total_students} students (${percentage}%)</span>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Classes
            if (dayData.classes && dayData.classes.length > 0) {
                html += '<div class="modal-section"><div class="modal-section-title"><i class="bi bi-book"></i> Scheduled Classes (' + dayData.classes.length + ')</div>';
                
                // Group classes by time
                const classesByTime = {};
                dayData.classes.forEach(cls => {
                    if (!classesByTime[cls.time]) {
                        classesByTime[cls.time] = [];
                    }
                    classesByTime[cls.time].push(cls);
                });
                
                // Sort times
                const sortedTimes = Object.keys(classesByTime).sort();
                
                sortedTimes.forEach(time => {
                    classesByTime[time].forEach(cls => {
                        html += `
                            <div class="modal-item class">
                                <div class="modal-item-title">
                                    <i class="bi bi-journal-code"></i> ${cls.unit} - ${cls.unit_name}
                                </div>
                                <div class="modal-item-meta">
                                    <span class="meta-item"><i class="bi bi-clock"></i> ${cls.time}</span>
                                    <span class="meta-item"><i class="bi bi-geo-alt"></i> ${cls.venue} (${cls.venue_name})</span>
                                    <span class="meta-item"><i class="bi bi-person"></i> ${cls.lecturer}</span>
                                    <span class="meta-item"><i class="bi bi-mortarboard"></i> ${cls.programme} Year ${cls.year_level}</span>
                                </div>
                            </div>
                        `;
                    });
                });
                html += '</div>';
            }
            
            modalBody.innerHTML = html;
        }
        
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    // Close modal
    function closeModal() {
        const modal = document.getElementById('dayModal');
        modal.classList.remove('active');
        document.body.style.overflow = 'auto';
    }
    
    // Close modal when clicking outside
    document.getElementById('dayModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeModal();
        }
    });
    
    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeModal();
        } else if (e.key === 'ArrowLeft' && !document.querySelector('.modal.active')) {
            navigateMonth(-1);
        } else if (e.key === 'ArrowRight' && !document.querySelector('.modal.active')) {
            navigateMonth(1);
        }
    });
    
    console.log('Admin academic calendar loaded successfully');
</script>
{% endblock %}